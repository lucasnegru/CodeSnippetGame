{% extends "base.html" %}
{% block content %}
<div class="grid" style="grid-template-columns: 1fr 2fr; gap:1rem;">
  <section>
    <div class="card">
      <div class="text-muted" style="font-size:.75rem; text-transform:uppercase; letter-spacing:.06em;">
        Level {{ snip.level }} • {{ snip.language|capitalize }}
      </div>
      <h2 style="font-weight:700; margin:.2rem 0 0;">{{ snip.title }}</h2>
      <p style="margin-top:.5rem; white-space:pre-line;">{{ snip.prompt }}</p>
      {% if snip.tips %}
      <details style="margin-top:.75rem;">
        <summary class="text-muted" style="cursor:pointer;">Tipps</summary>
        <ul style="margin:.5rem 0 0 1rem;">
          {% for t in snip.tips %}<li>{{ t }}</li>{% endfor %}
        </ul>
      </details>
      {% endif %}
    </div>

    {% if snip.blocks %}
    <div class="card" style="margin-top:1rem;">
      <h3 style="font-weight:600;">Bausteine</h3>
      <div id="blocks" class="chips" style="margin-top:.5rem;">
        {% for b in snip.blocks %}
        <button type="button" class="chip" data-val='{{ b|tojson }}'>{{ b }}</button>
        {% endfor %}
      </div>
      <p class="text-muted" style="margin-top:.5rem; font-size:.8rem;">Klicke einen Baustein, um ihn ins aktive Feld zu übernehmen.</p>
    </div>
    {% endif %}
  </section>

  <section>
    <div class="card">
      <h3 style="font-weight:600;">Vervollständige den Code</h3>

      <pre class="codeblock" style="margin-top:.75rem;"><code>{{ snip.code_template | replace("{{", "{ {") | replace("}}", "} }") }}</code></pre>
      <div id="snippet-data"
          data-snip-id="{{ snip.id }}"
          data-solution='{{ snip.solution|tojson }}'>
      </div>

      <form id="answerForm" style="margin-top:.8rem;">
        <div class="grid" style="grid-template-columns: repeat(2, minmax(0,1fr)); gap:.75rem;">
          {% for i in gaps %}
          <label style="font-size:.9rem;">Feld {{ i }}
            <input class="field" name="gap{{ i }}" data-index="{{ i }}" placeholder="Antwort für {{ i }}" />
          </label>
          {% endfor %}
        </div>
        <div style="margin-top:.8rem; display:flex; gap:.6rem; flex-wrap:wrap;">
          <button class="btn btn-dark" id="checkBtn">Prüfen</button>
          <button class="btn btn-outline" type="button" id="revealBtn">Lösung anzeigen</button>
        </div>
      </form>

      <div id="feedback" style="margin-top:.9rem; visibility:hidden;"></div>
      {% if next_snip %}
      <button id="next-task-btn"
              style="display:none; margin-top:1rem;"
              data-url="{{ url_for('snippet_view', sid=next_snip.id) }}">
        Nächste Aufgabe →
      </button>
      {% endif %}
    </div>
  </section>
</div>
{% endblock %}
